<div class="login-container">
  <div class="row g-0 h-100">
    <!-- Illustration section -->
    <div class="col-md-6 d-none d-md-flex illustration-col">
      <div class="illustration-wrapper d-flex flex-column justify-content-center text-center">
        <h2 class="text-white mb-3">Welcome to CareConnect Health</h2>
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA4MDAgNjAwIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImJnIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj48c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMWE3M2U4Ii8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjNDI4NWY0Ii8+PC9saW5lYXJHcmFkaWVudD48cmFkaWFsR3JhZGllbnQgaWQ9ImxpZ2h0IiBjeD0iNTAlIiBjeT0iMzAlIiByPSI1MCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmZmYiIHN0b3Atb3BhY2l0eT0iMC4yIi8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjZmZmIiBzdG9wLW9wYWNpdHk9IjAiLz48L3JhZGlhbEdyYWRpZW50PjwvZGVmcz48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0idXJsKCNiZykiLz48Y2lyY2xlIGN4PSI0MDAiIGN5PSIyMDAiIHI9IjMwMCIgZmlsbD0idXJsKCNsaWdodCkiLz48IS0tIERvY3RvciAtLT48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNTAsIDEzMCkiPjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjQwIiBmaWxsPSIjZmZmZmZmIi8+PHJlY3QgeD0iMTAiIHk9IjkwIiB3aWR0aD0iODAiIGhlaWdodD0iMTIwIiByeD0iMTAiIGZpbGw9IiNmOWY5ZjkiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjQwIiByPSIyMCIgZmlsbD0iI2Y5ZjlmOSIvPjxjaXJjbGUgY3g9IjQwIiBjeT0iNDUiIHI9IjQiIGZpbGw9IiM1NTU1NTUiLz48Y2lyY2xlIGN4PSI2MCIgY3k9IjQ1IiByPSI0IiBmaWxsPSIjNTU1NTU1Ii8+PHBhdGggZD0iTTQwLDYwIHEyMCwxMCA0MCwwIiBzdHJva2U9IiM1NTU1NTUiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PHJlY3QgeD0iMjUiIHk9IjEyMCIgd2lkdGg9IjUwIiBoZWlnaHQ9IjciIGZpbGw9IiMxYTczZTgiLz48cGF0aCBkPSJNODAsOTAgUzEyMCwxMTAgMTIwLDE3MiIgc3Ryb2tlPSIjMWE3M2U4IiBzdHJva2Utd2lkdGg9IjgiIGZpbGw9Im5vbmUiLz48Y2lyY2xlIGN4PSIxMjAiIGN5PSIxNzUiIHI9IjEwIiBmaWxsPSIjMWE3M2U4Ii8+PC9nPjwhLS0gUGF0aWVudCAtLT48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0NTAsIDEzMCkiPjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjQwIiBmaWxsPSIjZmZlY2IzIi8+PHJlY3QgeD0iMTAiIHk9IjkwIiB3aWR0aD0iODAiIGhlaWdodD0iMTIwIiByeD0iMTAiIGZpbGw9IiM0Mjg1ZjQiIG9wYWNpdHk9IjAuNyIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iNDAiIHI9IjIwIiBmaWxsPSIjZmZkOTgwIi8+PGNpcmNsZSBjeD0iNDAiIGN5PSI0NSIgcj0iNCIgZmlsbD0iIzU1NTU1NSIvPjxjaXJjbGUgY3g9IjYwIiBjeT0iNDUiIHI9IjQiIGZpbGw9IiM1NTU1NTUiLz48cGF0aCBkPSJNNDAsNjAgcTIwLDEwIDQwLDAiIHN0cm9rZT0iIzU1NTU1NSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48L2c+PHRleHQgeD0iNDAwIiB5PSI1NDAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iI2ZmZiI+Q2FyZUNvbm5lY3QgSGVhbHRoY2FyZTwvdGV4dD48L3N2Zz4=" alt="Healthcare illustration" class="img-fluid mb-4">
        <p class="text-white mb-2">Join our network of healthcare providers and grow your practice with our integrated platform.</p>
        <p class="text-white-50 mt-4">Trusted by over 1000+ healthcare professionals</p>
      </div>
    </div>

    <!-- Form section -->
    <div class="col-md-6 d-flex form-col order-2 order-md-1">
      <div class="login-form-wrapper px-3 py-4 p-sm-4 p-md-5 w-100 mx-auto">
        <div class="logo-area text-center mb-4">
          <h1>LemiCare Health</h1>
          <p class="tagline">Creating a healthier tomorrow</p>
        </div>

        <h2 class="form-title">Reset Password</h2>
        
        <p class="form-subtitle" *ngIf="step === 'request'">
          Enter your registered mobile number to receive an OTP
        </p>
        <p class="form-subtitle" *ngIf="step === 'verify'">
          Enter the 6-digit OTP sent to your mobile
        </p>
        <p class="form-subtitle" *ngIf="step === 'reset'">
          Create your new password
        </p>
        
        <!-- Error message display -->
        <div class="alert alert-danger" *ngIf="resetError">
          {{ resetError }}
        </div>
        
        <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()" class="mt-4">
          <!-- Mobile field (shown in step 1) -->
          <div class="form-group mb-4" *ngIf="step === 'request'">
            <label for="mobile" class="form-label">Mobile Number</label>
            <div class="input-group">
              <span class="input-group-text">+91</span>
              <input 
                type="tel" 
                id="mobile" 
                formControlName="mobile"
                class="form-control" 
                [ngClass]="{'is-invalid': forgotPasswordForm.controls['mobile'].invalid && forgotPasswordForm.controls['mobile'].touched}"
                placeholder="Enter 10 digit mobile number"
              >
            </div>
            <div class="invalid-feedback d-block" *ngIf="forgotPasswordForm.controls['mobile'].invalid && forgotPasswordForm.controls['mobile'].touched">
              Please enter a valid 10 digit mobile number
            </div>
          </div>

          <!-- Mobile number (read-only in steps 2 and 3) -->
          <div class="form-group mb-4" *ngIf="step !== 'request'">
            <label class="form-label">Mobile Number</label>
            <div class="input-group">
              <span class="input-group-text">+1</span>
              <input 
                type="tel" 
                class="form-control" 
                [value]="forgotPasswordForm.controls['mobile'].value"
                readonly
              >
            </div>
            <div class="form-text text-end">
              <button type="button" class="btn btn-link p-0" (click)="goBack()">
                Change mobile number
              </button>
            </div>
          </div>

          <!-- OTP field (shown in steps 2 and 3) -->
          <div class="form-group mb-4" *ngIf="step !== 'request'">
            <div class="d-flex align-items-center justify-content-between">
              <label for="otp" class="form-label">One Time Password</label>
              <button 
                type="button" 
                class="btn btn-link p-0" 
                (click)="requestOTP()" 
                *ngIf="step === 'verify'"
                [disabled]="loading"
              >
                {{ loading ? 'Sending...' : 'Resend OTP' }}
              </button>
            </div>
            <input 
              type="text" 
              id="otp" 
              formControlName="otp"
              class="form-control" 
              [ngClass]="{'is-invalid': forgotPasswordForm.controls['otp'].invalid && forgotPasswordForm.controls['otp'].touched}"
              placeholder="Enter 6 digit OTP"
              maxlength="6"
              [readOnly]="step === 'reset'"
            >
            <div class="invalid-feedback d-block" *ngIf="forgotPasswordForm.controls['otp'].invalid && forgotPasswordForm.controls['otp'].touched">
              Please enter a valid 6 digit OTP
            </div>
          </div>

          <!-- New Password field (step 3) -->
          <div class="form-group mb-4" *ngIf="step === 'reset'">
            <label for="newPassword" class="form-label">New Password</label>
            <input 
              type="password" 
              id="newPassword" 
              formControlName="newPassword"
              class="form-control" 
              [ngClass]="{'is-invalid': forgotPasswordForm.controls['newPassword'].invalid && forgotPasswordForm.controls['newPassword'].touched}"
              placeholder="Enter new password"
            >
            <div class="invalid-feedback d-block" *ngIf="forgotPasswordForm.controls['newPassword'].invalid && forgotPasswordForm.controls['newPassword'].touched">
              Password must be at least 6 characters
            </div>
          </div>

          <!-- Confirm Password field (step 3) -->
          <div class="form-group mb-4" *ngIf="step === 'reset'">
            <label for="confirmPassword" class="form-label">Confirm Password</label>
            <input 
              type="password" 
              id="confirmPassword" 
              formControlName="confirmPassword"
              class="form-control" 
              [ngClass]="{'is-invalid': forgotPasswordForm.get('confirmPassword')?.invalid && forgotPasswordForm.get('confirmPassword')?.touched || 
                                        forgotPasswordForm.hasError('notSame') && forgotPasswordForm.get('confirmPassword')?.touched}"
              placeholder="Confirm new password"
            >
            <div class="invalid-feedback d-block" *ngIf="forgotPasswordForm.get('confirmPassword')?.invalid && forgotPasswordForm.get('confirmPassword')?.touched">
              Please confirm your password
            </div>
            <div class="invalid-feedback d-block" *ngIf="forgotPasswordForm.hasError('notSame') && forgotPasswordForm.get('confirmPassword')?.touched">
              Passwords do not match
            </div>
          </div>

          <!-- Submit button -->
          <div class="form-group mt-4">
            <button type="submit" class="btn btn-primary w-100" [disabled]="loading">
              <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
              {{ step === 'request' ? 'Send OTP' : (step === 'verify' ? 'Verify OTP' : 'Reset Password') }}
            </button>
          </div>

        </form>
        
        <div class="mt-4 text-center text-md-start">
          <span>Remember your password? </span>
          <a [routerLink]="['../login']" class="text-primary fw-bold">Back to Login</a>
        </div>

        
        
        <!-- Footer -->
        <div class="powered-by mt-4 text-center">
          <p class="text-muted small mb-0 text-center">Powered by <span class="fw-bold">SmartBridge Innovations</span></p>
        </div>
      </div>
    </div>
  </div>
</div>
